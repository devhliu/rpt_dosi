#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import click
import rpt_dosi as rpt
import SimpleITK as itk

CONTEXT_SETTINGS = dict(help_option_names=["-h", "--help"])


@click.command(context_settings=CONTEXT_SETTINGS)
@click.option("--dose_filename", "-i", required=True, help="Dose filename")
@click.option(
    "--activity",
    "-a",
    required=True,
    type=float,
    help="Initial total simulated activity in Bq",
)
@click.option(
    "--target_activity",
    "-t",
    required=True,
    type=float,
    help="Final total activity in Bq",
)
@click.option("--output", "-o", required=True, help="output filename")
@click.option(
    "--body", "-b", default=None, help="Body roi for setting dose value to zero"
)
def go(dose_filename, activity, target_activity, body, output):
    # create simulation
    dose = itk.ReadImage(dose_filename)

    # scale and crop
    dose = rpt.images.dose_scale_and_crop(dose, activity, target_activity, body)

    # write
    itk.WriteImage(dose, output)


# --------------------------------------------------------------------------
if __name__ == "__main__":
    go()
